{"version":3,"sources":["../../../../../../../src/webgpu/api/validation/encoding/cmds/render/setVertexBuffer.spec.ts"],"names":["description","makeTestGroup","GPUConst","DefaultLimits","ValidationTest","kRenderEncodeTypeParams","kBufferStates","buildBufferOffsetAndSizeOOBTestParams","g","test","desc","paramsSubcasesOnly","combine","maxVertexBuffers","fn","t","encoderType","slot","params","vertexBuffer","createBufferWithState","size","usage","GPUBufferUsage","VERTEX","encoder","finish","createEncoder","setVertexBuffer","expectValidationError","state","queue","submit","BufferUsage","COPY_DST","device","createBuffer","offset","_valid"],"mappings":"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","sourcesContent":["export const description = `\nValidation tests for setVertexBuffer on render pass and render bundle.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { GPUConst, DefaultLimits } from '../../../../../constants.js';\nimport { ValidationTest } from '../../../validation_test.js';\n\nimport {\n  kRenderEncodeTypeParams,\n  kBufferStates,\n  buildBufferOffsetAndSizeOOBTestParams,\n} from './render.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('slot')\n  .desc(\n    `\nTests slot must be less than the maxVertexBuffers in device limits.\n  `\n  )\n  .paramsSubcasesOnly(\n    kRenderEncodeTypeParams.combine('slot', [\n      0,\n      DefaultLimits.maxVertexBuffers - 1,\n      DefaultLimits.maxVertexBuffers,\n    ] as const)\n  )\n  .fn(t => {\n    const { encoderType, slot } = t.params;\n    const vertexBuffer = t.createBufferWithState('valid', {\n      size: 16,\n      usage: GPUBufferUsage.VERTEX,\n    });\n\n    const { encoder, finish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(slot, vertexBuffer);\n\n    t.expectValidationError(() => {\n      finish();\n    }, slot >= DefaultLimits.maxVertexBuffers);\n  });\n\ng.test('vertex_buffer')\n  .desc(\n    `\nTests vertex buffer must be valid.\n  `\n  )\n  .paramsSubcasesOnly(kRenderEncodeTypeParams.combine('state', kBufferStates))\n  .fn(t => {\n    const { encoderType, state } = t.params;\n    const vertexBuffer = t.createBufferWithState(state, {\n      size: 16,\n      usage: GPUBufferUsage.VERTEX,\n    });\n\n    const { encoder, finish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer);\n\n    t.expectValidationError(() => {\n      if (state === 'destroyed') {\n        t.queue.submit([finish()]);\n      } else {\n        finish();\n      }\n    }, state !== 'valid');\n  });\n\ng.test('vertex_buffer_usage')\n  .desc(\n    `\nTests vertex buffer must have 'Vertex' usage.\n  `\n  )\n  .paramsSubcasesOnly(\n    kRenderEncodeTypeParams.combine('usage', [\n      GPUConst.BufferUsage.VERTEX, // control case\n      GPUConst.BufferUsage.COPY_DST,\n      GPUConst.BufferUsage.COPY_DST | GPUConst.BufferUsage.VERTEX,\n    ] as const)\n  )\n  .fn(t => {\n    const { encoderType, usage } = t.params;\n    const vertexBuffer = t.device.createBuffer({\n      size: 16,\n      usage,\n    });\n\n    const { encoder, finish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer);\n\n    t.expectValidationError(() => {\n      finish();\n    }, (usage | GPUConst.BufferUsage.VERTEX) !== usage);\n  });\n\ng.test('offset_alignment')\n  .desc(\n    `\nTests offset must be a multiple of 4.\n  `\n  )\n  .paramsSubcasesOnly(kRenderEncodeTypeParams.combine('offset', [0, 2, 4] as const))\n  .fn(t => {\n    const { encoderType, offset } = t.params;\n    const vertexBuffer = t.device.createBuffer({\n      size: 16,\n      usage: GPUBufferUsage.VERTEX,\n    });\n\n    const { encoder, finish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer, offset);\n\n    t.expectValidationError(() => {\n      finish();\n    }, offset % 4 !== 0);\n  });\n\ng.test('offset_and_size_oob')\n  .desc(\n    `\nTests offset and size cannot be larger than vertex buffer size.\n  `\n  )\n  .paramsSubcasesOnly(buildBufferOffsetAndSizeOOBTestParams(4, 256))\n  .fn(t => {\n    const { encoderType, offset, size, _valid } = t.params;\n    const vertexBuffer = t.device.createBuffer({\n      size: 256,\n      usage: GPUBufferUsage.VERTEX,\n    });\n\n    const { encoder, finish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer, offset, size);\n\n    t.expectValidationError(() => {\n      finish();\n    }, !_valid);\n  });\n"],"file":"setVertexBuffer.spec.js"}